<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopcart - Home</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
  .product-card img {
    transition: transform 0.35s cubic-bezier(.4,2,.6,1), box-shadow 0.25s;
    cursor: pointer;
    will-change: transform;
  }
  .product-card:hover img {
    transform: scale(1.13);
    box-shadow: 0 8px 32px rgba(0,0,0,0.18);
    z-index: 2;
  }
  .product-card .product-rating {
    display: flex;
    align-items: center;
    gap: 6px;
    margin: 6px 0 0 0;
    font-size: 1.1em;
  }
  .product-card .product-rating .stars {
    color: #fbbf24;
    font-size: 1.1em;
    letter-spacing: 1px;
  }
  .product-card .product-stock {
    color: #64748b;
    font-size: 0.98em;
    margin-top: 2px;
  }
  .hero {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    padding: 2.5rem 1rem 2.5rem 1rem;
    background: #f5f7fa;
    gap: 2rem;
  }
  .hero-content {
    flex: 1 1 320px;
    min-width: 280px;
    max-width: 500px;
    z-index: 2;
  }
  .hero-image {
    flex: 2 1 480px;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 320px;
    max-width: 900px;
    width: 100%;
  }
  .hero-image img {
    width: 100%;
    max-width: 900px;
    height: auto;
    border-radius: 24px;
    object-fit: cover;
    box-shadow: 0 8px 32px rgba(30,41,59,0.13);
    display: block;
  }
  @media (max-width: 900px) {
    .hero { flex-direction: column; padding: 1.5rem 0.5rem; }
    .hero-image { max-width: 100vw; }
    .hero-image img { max-width: 100vw; }
  }
  @media (max-width: 600px) {
    .hero-content { max-width: 100vw; }
    .hero-image { min-width: 0; }
    .hero-image img { border-radius: 12px; }
  }
  .categories {
    margin: 2.5rem auto 1.5rem auto;
    max-width: 1200px;
    padding: 0 1rem;
  }
  .category-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 2.5rem;
    margin-top: 1.2rem;
    margin-bottom: 1.2rem;
  }
  .category-item {
    font-size: 1.08rem;
    font-weight: 500;
    color: #222;
    background: none;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 0.2rem 0.7rem;
    border-radius: 8px;
    transition: background 0.18s, color 0.18s;
  }
  .category-item:hover, .category-item.active {
    background: #e0e7ef;
    color: #4f46e5;
  }
  @media (max-width: 700px) {
    .category-list { gap: 1.1rem; }
    .category-item { font-size: 0.98rem; padding: 0.18rem 0.5rem; }
  }
  .custom-dropdown {
    position: relative;
    display: inline-block;
    width: 180px;
    font-size: 1rem;
    font-weight: 500;
    color: #222;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 12px rgba(30,41,59,0.07);
    cursor: pointer;
    transition: box-shadow 0.2s;
    z-index: 10;
    border: 2.5px solid #e0e7ef;
  }
  .custom-dropdown .selected {
    padding: 10px 18px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.18s;
  }
  .custom-dropdown.open .selected {
    background: #f3f4f6;
  }
  .custom-dropdown .dropdown-list {
    position: absolute;
    left: 0;
    right: 0;
    top: 110%;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 8px 32px rgba(30,41,59,0.13);
    opacity: 0;
    pointer-events: none;
    transform: translateY(-10px);
    transition: opacity 0.25s, transform 0.25s;
    overflow: hidden;
    border: 2.5px solid #e0e7ef;
  }
  .custom-dropdown.open .dropdown-list {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }
  .custom-dropdown .dropdown-item {
    padding: 12px 18px;
    cursor: pointer;
    transition: background 0.18s, color 0.18s;
    font-size: 1rem;
  }
  .custom-dropdown .dropdown-item:hover, .custom-dropdown .dropdown-item.selected {
    background: #e0e7ef;
    color: #4f46e5;
  }
  </style>
</head>
<body>
  <!-- Header/Navbar -->
  <header>
    <nav class="navbar">
      <div class="logo">
        <i class="fa-solid fa-cart-shopping"></i> Shopcart
      </div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="#categories">Categories</a></li>
        <li><a href="deals.html">Deals</a></li>
        <!-- <li><a href="#whatsnew">What's New</a></li> -->
        <!-- <li><a href="delivery.html">Delivery</a></li> -->
      </ul>
      <div class="nav-actions">
        <input type="text" id="searchInput" placeholder="Search Product">
        <a href="cart.html" class="cart-icon"><i class="fa-solid fa-cart-shopping"></i><span id="cartCount">0</span></a>
        <a href="orders.html" class="user-icon"><i class="fa-solid fa-user"></i></a>
        <span class="admin-icon" onclick="window.location.href='admin.html'" style="cursor:pointer;"><i class="fa-solid fa-user-shield"></i></span>
        <button class="hamburger" id="hamburgerBtn"><i class="fa-solid fa-bars"></i></button>
      </div>
    </nav>
    <div class="mobile-menu" id="mobileMenu">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="#categories">Categories</a></li>
        <li><a href="deals.html">Deals</a></li>
        <!-- <li><a href="#whatsnew">What's New</a></li> -->
        <!-- <li><a href="delivery.html">Delivery</a></li> -->
        <li><a href="cart.html">Cart</a></li>
        <li><a href="orders.html">My Orders</a></li>
      </ul>
    </div>
  </header>

  <!-- Hero Banner -->
  <section class="hero">
    <div class="hero-content">
      <h1>Grab Upto 35% Off On Dashain Offer</h1>
      <p>Best deals on Apple products. Limited time offer!</p>
      <a href="#products" class="btn-primary">Buy Now</a>
    </div>
    <div class="hero-image">
      <img src="https://9to5mac.com/wp-content/uploads/sites/6/2024/07/apple-device-lineup.jpg?quality=82&strip=all" alt="Headphone">
    </div>
  </section>

  <!-- Categories -->
  <section class="categories" id="categories">
    <h2>Popular Categories</h2>
    <div class="category-list" id="categoryList">
      <button class="category-item">All</button>
      <button class="category-item">Mac</button>
      <button class="category-item">iPad</button>
      <button class="category-item">iPhone</button>
      <button class="category-item">Watch</button>
      <button class="category-item">Vision</button>
      <button class="category-item">AirPods</button>
      <button class="category-item">TV & Home</button>
      <button class="category-item">Accessories</button>
    </div>
  </section>

  <!-- Featured Products -->
  <section class="products" id="products">
    <div class="products-header">
      <h2>Gadgets For You!</h2>
      <div class="filters">
        <div class="custom-dropdown" id="sortDropdown">
          <div class="selected" id="sortSelected">Sort by Price</div>
          <div class="dropdown-list" id="sortDropdownList">
            <div class="dropdown-item" data-value="default">Sort by Price</div>
            <div class="dropdown-item" data-value="low">Low to High</div>
            <div class="dropdown-item" data-value="high">High to Low</div>
          </div>
        </div>
      </div>
    </div>
    <div class="product-grid" id="productGrid">
      <!-- Products will be injected by JS -->
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-logo"><i class="fa-solid fa-cart-shopping"></i> Shopcart</div>
      <div class="footer-links">
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
        <a href="#">Contact</a>
      </div>
      <div class="footer-social">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
      </div>
    </div>
    <div class="footer-bottom">© 2025 Shopcart -Balram. All rights reserved.</div>
  </footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const productGrid = document.getElementById("productGrid");
  const priceFilter = document.getElementById("filterPrice");
  const searchInput = document.getElementById("searchInput");
  const cartCountSpan = document.getElementById("cartCount");

  // Remove default products, only use admin products
  let products = JSON.parse(localStorage.getItem("products")) || [];

  // --- Ensure each product has a persistent random rating count ---
  let ratingCounts = JSON.parse(localStorage.getItem('productRatingCounts') || '{}');
  let updated = false;
  products.forEach(p => {
    if (!ratingCounts[p.id]) {
      ratingCounts[p.id] = Math.floor(Math.random() * 900) + 100;
      updated = true;
    }
  });
  if (updated) localStorage.setItem('productRatingCounts', JSON.stringify(ratingCounts));

  // ✅ Render products
  function renderProducts(items) {
    if (items.length === 0) {
      productGrid.innerHTML = "<p>No products found.</p>";
      return;
    }
    productGrid.innerHTML = items.map(p => {
      // Use persistent random rating count
      const ratingCount = ratingCounts[p.id] || 100;
      // Use only real images
      const imgSrc = (p.images && p.images[0]) ? p.images[0] : '';
      return `
        <div class="product-card" style="display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:1.2rem 1rem 1.2rem 1rem;box-shadow:0 2px 8px rgba(0,0,0,0.06);border-radius:16px;min-width:220px;max-width:270px;width:100%;background:#fff;">
          <div style="width:100%;flex:1 1 auto;display:flex;align-items:center;justify-content:center;min-height:180px;max-height:220px;overflow:hidden;border-radius:14px;margin-bottom:0.7rem;">
            <img src="${imgSrc}" alt="${p.name}" style="width:100%;height:200px;object-fit:contain;display:block;">
          </div>
          <h3 style="margin:0 0 0.2rem 0;font-size:1.13rem;font-weight:600;">${p.name}</h3>
          <div class="product-rating" style="margin:0 0 0.1rem 0;">
            <span class="stars">★★★★★</span>
            <span class="rating-count">(${ratingCount})</span>
          </div>
          <div class="product-stock" style="margin-bottom:0.2rem;">Stock: ${p.stock}</div>
          <div style="width:100%;display:flex;align-items:center;justify-content:space-between;margin-top:0.2rem;">
            <p class="price" style="font-size:1.18rem;font-weight:700;color:#174832;margin:0;">$${Number(p.price).toFixed(2)}</p>
            <button onclick="viewProduct('${p.id}')" style="margin-left:auto;margin-right:0;min-width:110px;">View Details</button>
          </div>
        </div>
      `;
    }).join('');
  }

  // Custom dropdown logic
  const sortDropdown = document.getElementById('sortDropdown');
  const sortSelected = document.getElementById('sortSelected');
  const sortDropdownList = document.getElementById('sortDropdownList');
  let sortValue = 'default';
  sortSelected.addEventListener('click', () => {
    sortDropdown.classList.toggle('open');
  });
  sortDropdownList.querySelectorAll('.dropdown-item').forEach(item => {
    item.addEventListener('click', function() {
      sortDropdownList.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('selected'));
      this.classList.add('selected');
      sortValue = this.getAttribute('data-value');
      sortSelected.textContent = this.textContent;
      sortDropdown.classList.remove('open');
      // Trigger sorting
      applyFilters();
    });
  });
  document.addEventListener('click', (e) => {
    if (!sortDropdown.contains(e.target)) sortDropdown.classList.remove('open');
  });

  function applyFilters() {
    let filtered = [...products];
    const searchTerm = searchInput.value.toLowerCase();

    if (searchTerm) {
      filtered = filtered.filter(p => p.name.toLowerCase().includes(searchTerm));
    }
    if (sortValue === "low") {
      filtered.sort((a, b) => a.price - b.price);
    } else if (sortValue === "high") {
      filtered.sort((a, b) => b.price - a.price);
    }
    renderProducts(filtered);
  }

  searchInput.addEventListener("input", applyFilters);

  let selectedCategory = null;
  const categoryButtons = document.querySelectorAll('.category-item');
  categoryButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      categoryButtons.forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      selectedCategory = this.textContent.trim();
      if (selectedCategory === 'All') {
        renderProducts(products);
      } else {
        let filtered = products.filter(p => p.category === selectedCategory);
        renderProducts(filtered);
      }
    });
  });
  // Set 'All' as active by default
  categoryButtons[0].classList.add('active');

  // Optionally, show all products on page load or when no category is selected
  renderProducts(products);

  // ✅ Expose viewProduct function
  window.viewProduct = (id) => {
    localStorage.setItem("selectedProductId", id);
    window.location.href = `product.html?id=${id}`;
  };

  // ✅ Update cart count in real-time
  function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    let count = 0;
    for (const item of cart) count += item.qty || 1;
    cartCountSpan.textContent = count;
  }
  updateCartCount(); // Initial count
  setInterval(updateCartCount, 1000); // Update every second
});
</script>
</body>
</html>
