<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopcart - Home</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
  .product-card img {
    transition: transform 0.35s cubic-bezier(.4,2,.6,1), box-shadow 0.25s;
    cursor: pointer;
    will-change: transform;
  }
  .product-card:hover img {
    transform: scale(1.13);
    box-shadow: 0 8px 32px rgba(0,0,0,0.18);
    z-index: 2;
  }
  .product-card .product-rating {
    display: flex;
    align-items: center;
    gap: 6px;
    margin: 6px 0 0 0;
    font-size: 1.1em;
  }
  .product-card .product-rating .stars {
    color: #fbbf24;
    font-size: 1.1em;
    letter-spacing: 1px;
  }
  .product-card .product-stock {
    color: #64748b;
    font-size: 0.98em;
    margin-top: 2px;
  }
  </style>
</head>
<body>
  <!-- Header/Navbar -->
  <header>
    <nav class="navbar">
      <div class="logo">
        <i class="fa-solid fa-cart-shopping"></i> Shopcart
      </div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="#categories">Categories</a></li>
        <li><a href="#deals">Deals</a></li>
        <li><a href="#whatsnew">What's New</a></li>
        <li><a href="#delivery">Delivery</a></li>
      </ul>
      <div class="nav-actions">
        <input type="text" id="searchInput" placeholder="Search Product">
        <a href="cart.html" class="cart-icon"><i class="fa-solid fa-cart-shopping"></i><span id="cartCount">0</span></a>
        <a href="orders.html" class="user-icon"><i class="fa-solid fa-user"></i></a>
        <button class="hamburger" id="hamburgerBtn"><i class="fa-solid fa-bars"></i></button>
      </div>
    </nav>
    <div class="mobile-menu" id="mobileMenu">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="#categories">Categories</a></li>
        <li><a href="#deals">Deals</a></li>
        <li><a href="#whatsnew">What's New</a></li>
        <li><a href="#delivery">Delivery</a></li>
        <li><a href="cart.html">Cart</a></li>
        <li><a href="orders.html">My Orders</a></li>
      </ul>
    </div>
  </header>

  <!-- Hero Banner -->
  <section class="hero">
    <div class="hero-content">
      <h1>Grab Upto 50% Off On Dashain Offer</h1>
      <p>Best deals on top brands. Limited time offer!</p>
      <a href="#products" class="btn-primary">Buy Now</a>
    </div>
    <div class="hero-image">
      <img src="https://www.webse.co.uk/cdn/shop/files/14b0331b-55f8-4060-9977-4e4563ecb033-2_1dfbe38e-91e0-4e76-86f7-1eeca0d3b405.jpg?v=1748943367" alt="Headphone">
    </div>
  </section>

  <!-- Categories -->
  <section class="categories" id="categories">
    <h2>Popular Categories</h2>
    <div class="category-list" id="categoryList">
      <!-- Categories will be injected by JS -->
    </div>
  </section>

  <!-- Featured Products -->
  <section class="products" id="products">
    <div class="products-header">
      <h2>Headphones For You!</h2>
      <div class="filters">
        <select id="filterCategory">
          <option value="all">All Categories</option>
        </select>
        <select id="filterPrice">
          <option value="default">Sort by Price</option>
          <option value="low">Low to High</option>
          <option value="high">High to Low</option>
        </select>
      </div>
    </div>
    <div class="product-grid" id="productGrid">
      <!-- Products will be injected by JS -->
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-logo"><i class="fa-solid fa-cart-shopping"></i> Shopcart</div>
      <div class="footer-links">
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
        <a href="#">Contact</a>
      </div>
      <div class="footer-social">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
      </div>
    </div>
    <div class="footer-bottom">&copy; 2024 Shopcart. All rights reserved.</div>
  </footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const productGrid = document.getElementById("productGrid");
  const categoryFilter = document.getElementById("filterCategory");
  const priceFilter = document.getElementById("filterPrice");
  const searchInput = document.getElementById("searchInput");

  // Remove default products, only use admin products
  let products = JSON.parse(localStorage.getItem("products")) || [];

  // --- Ensure each product has a persistent random rating count ---
  let ratingCounts = JSON.parse(localStorage.getItem('productRatingCounts') || '{}');
  let updated = false;
  products.forEach(p => {
    if (!ratingCounts[p.id]) {
      ratingCounts[p.id] = Math.floor(Math.random() * 900) + 100;
      updated = true;
    }
  });
  if (updated) localStorage.setItem('productRatingCounts', JSON.stringify(ratingCounts));

  // ✅ Render products
  function renderProducts(items) {
    if (items.length === 0) {
      productGrid.innerHTML = "<p>No products found.</p>";
      return;
    }
    productGrid.innerHTML = items.map(p => {
      // Use persistent random rating count
      const ratingCount = ratingCounts[p.id] || 100;
      // Use only real images
      const imgSrc = (p.images && p.images[0]) ? p.images[0] : '';
      return `
        <div class="product-card">
          <img src="${imgSrc}" alt="${p.name}">
          <h3>${p.name}</h3>
          <div class="product-rating">
            <span class="stars">★★★★★</span>
            <span class="rating-count">(${ratingCount})</span>
          </div>
          <div class="product-stock">Stock: ${p.stock}</div>
          <p class="price">$${p.price}</p>
          <button onclick="viewProduct('${p.id}')">View Details</button>
        </div>
      `;
    }).join('');
  }

  function populateCategories() {
    const uniqueCats = [...new Set(products.map(p => p.category))];
    uniqueCats.forEach(cat => {
      const opt = document.createElement("option");
      opt.value = cat;
      opt.textContent = cat;
      categoryFilter.appendChild(opt);
    });
  }

  function applyFilters() {
    let filtered = [...products];
    const selectedCategory = categoryFilter.value;
    const searchTerm = searchInput.value.toLowerCase();

    if (selectedCategory !== "all") {
      filtered = filtered.filter(p => p.category === selectedCategory);
    }
    if (searchTerm) {
      filtered = filtered.filter(p => p.name.toLowerCase().includes(searchTerm));
    }
    if (priceFilter.value === "low") {
      filtered.sort((a, b) => a.price - b.price);
    } else if (priceFilter.value === "high") {
      filtered.sort((a, b) => b.price - a.price);
    }
    renderProducts(filtered);
  }

  categoryFilter.addEventListener("change", applyFilters);
  priceFilter.addEventListener("change", applyFilters);
  searchInput.addEventListener("input", applyFilters);

  renderProducts(products);
  populateCategories();

  // ✅ Expose viewProduct function
  window.viewProduct = (id) => {
    localStorage.setItem("selectedProductId", id);
    window.location.href = `product.html?id=${id}`;
  };
});
</script>
</body>
</html>
